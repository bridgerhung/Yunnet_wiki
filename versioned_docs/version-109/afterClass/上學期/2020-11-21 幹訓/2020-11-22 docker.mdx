---
title:  幹訓4
sidebar_position: 4
description: Docker
---

:::info
[原始 MD by 祐民](https://hackmd.io/@ji03mmy18/SkY_AJhKv?type=slide#/)
:::

# Docker 好好玩

### 幹訓特別課程

_YoMin Su_

---

## 回想一下

---

### 身旁有沒有朋友打手遊打到走火入魔?

---

![](https://i.imgur.com/xVRLp9h.jpg)
13 開的「天堂 2 革命」

---

### 或是拿買賣遊戲帳號當日常的朋友?

---

![](https://i.imgur.com/7w3XCED.jpg)
為了賺小錢，連虛擬機都拿來用了

---

### 甚至是，在一台電腦上裝多個系統?!

---

![](https://i.imgur.com/otejJPs.png)
這一台主機裝了 7 個 Windows...

---

### 以上皆為取自網路的真實案例

---

### 今天要說的 Docker 則是在 Linux 的容器

![](https://i.imgur.com/4gwSdo4.png =500x)
(虛擬機的一種)

---

### 有沒有想過開 Minecraft 伺服器可以...

---

### 從這樣

![](https://i.imgur.com/jw9aUYm.png)

---

### 變這樣

![](https://i.imgur.com/m9cbnDx.png)

---

### 你一定會問，那兩張有差嗎?

有差，當然有差，不然幹嘛提 xD

---

### 那，差在哪?

一個需要你從官網下載檔案，自己處理所有東西
另一個只需要一條指令，便將所有東西都準備好

---

### 除了方便架伺服器外，還能做啥?

架各種服務、各種實驗環境、服務之間各自切分、etc...

---

## 那實際上該怎麼使用呢?

---

### 首先，你需要有 Docker Engine

但令人難過的是，Docker 沒辦法跑在你們目前的系統上，就算有 WSL 也是一樣(WSL 2 除外)

---

### 解決辦法

① 將 WSL 1 升級到 WSL 2，並安裝 Docker Desktop
~~② 使用我提供的系統~~
③ 裝任一 Linux 系統到你的筆電上 <-- 推薦！！

---

### 良心建議

如果你覺得你之後依然會想玩 Docker 的話，建議用 ① 或 ③
~~若覺得今天過後就不會用到的話，建議選擇 ②~~

> ~~辦法 2 的系統在幹訓後就會移除!~~

---

### 解決辦法 ①

```shell=
wsl -l -v #找到你使用的Distro
wsl --set-version <Distro> 2 #將版本修改為2
```

> 記得安裝 Docker Desktop

---

### 解決辦法 ②

~~SSH 到以下位置，帳號是學號，密碼是學號去頭~~

> ~~140.125.207.217:2270~~

---

### 解決辦法 ③

雖然很棒，但今天可能不太適合...

---

### 相信各位的 Docker 都應該可以使用了，無論你用哪種方法，可以上課的方法，就是好方法~

---

## 首次嘗試

---

### Hello-World 的部分

> docker run hello-world

---

#### 執行畫面

![](https://i.imgur.com/caZDzET.png)

---

### 指令分析

| 指令        | 用途           |
| ----------- | -------------- |
| docker      | 一切的起頭     |
| run         | 執行一個 Image |
| hello-world | Image 的名稱   |

---

### 拿 Minecraft 伺服器當範例

若想開一個伺服器的話...

> docker run
> -e EULA=TRUE
> -d
> -p 25565:25565
> \-\-name mc
> itzg/minecraft-server

---

## 看起來是不是超複雜，超難懂?

![](https://i.imgur.com/yQYy8f7.png)
一臉黑人問號...嗎?

---

## 我們一個一個參數來解釋吧!

---

### 「-e」參數

用於設定環境變數

> EULA=TRUE

---

### 「-d」參數

用於讓 Container 執行在背景

> 就在背後跑，沒啥好說的~

---

### 「-p」參數

Port 映射，將容器裡面的 Port 對到容器外面
前面是外面，後面是裡面

> 25565:25565

---

#### 友情提醒

預設情況下，Docker 會直接操作系統的 iptables，因此會直接跨過 ufw，若你希望服務只能在 Local 存取，請在 Port 前面加上 127.0.0.1，就像範例這樣

> 127.0.0.1:25565:25565

---

### 「\-\-name」

幫容器取名字，方便你管理

> mc

---

### itzg/minecraft-server

就是 MC 伺服器的 Image 之一
![](https://i.imgur.com/6t5VklK.png)

> 也就 10M+人在用而已啦~

---

### 若你玩的是 Bedrock(基岩)版的話...

![](https://i.imgur.com/Lu7w6MS.png)

> 好像也有 Image 可以用呢!

---

### 除上述以外，「-v」參數

可以把裡面跟外面的檔案 Mapping 起來
路徑中間用「:」連接

> 前面是外面，後面是裡面

---

#### 小測驗時間

> /srv/gitlab:/etc/gitlab

哪個在內?哪個在外?

---

### 如果想在容器中執行指令的話

> docker exec -i mc rcon-cli

| 指令     | 用途           |
| -------- | -------------- |
| exec     | 執行指令       |
| -i       | 讓介面可以互動 |
| mc       | Container 名稱 |
| rcon-cli | 指令 or 功能   |

---

## Dockerfile

容器映像的起承轉合

---

### 用途

別人的映像很方便，我也想自己弄一個，可以嗎?

> 當然可以！

---

### 快速教學時間

```dockerfile=
FROM golang:1.15.5-alpine3.12
MAINTAINER YoMin_Su

WORKDIR /data
ADD . /data
RUN cd /data && go build
EXPOSE 8080
ENTRYPOINT ./data
```

---

### 快速解釋時間

|            |                                  |
| ---------- | -------------------------------- |
| FROM       | 讓此映像建立在另一個映像上       |
| MAINTAINER | 此映像的設計者(製作者)           |
| WORKDIR    | 容器內的預設工作目錄             |
| ADD        | 將目錄內的檔案複製到映像中       |
| RUN        | 在映像中執行指令                 |
| EXPOSE     | 開一個"門"讓外側可以 Bind 通訊埠 |
| ENTRYPOINT | 在映像啟動後執行的指令(程式)     |

---

### 範例內容

API.go

```go=
package main

import (
    "fmt"
    "log"
    "net/http"
)

func main() {
    http.HandleFunc("/test", func(w http.ResponseWriter, r *http.Request) {
        fmt.Fprintf(w, "API Working!")
    })

    log.Fatal(http.ListenAndServe(":8080", nil))
}
```

---

## Docker 很厲害，但有沒有方便執行的工具?

---

### 當然有，就是 Docker-Compose

![](https://i.imgur.com/nVsjp6M.png =800x)
幫你把所有設定集合起來，一次執行的好方法

---

### 首先提一下如何使用

---

### 啟動容器

> docker-compose up

加上「-f」可以指定設定檔
加上「-d」可以在背景執行

---

### 停止容器

> docker-compose down

若是以指定檔名的方式去啟動的話，記得一樣要指定檔名來結束

---

### 接下來來看內容大概長怎樣

---

#### 範例的說

![](https://i.imgur.com/z49neWK.png)

---

#### 還是範例的說，多個服務

![](https://i.imgur.com/FYjX4mL.png)

---

### 格式的部分

首先要注意的是，這是 yml 檔，也就是 YAML 格式

雖然不像 Python 那樣對空格極度敏感，但<span class=bluegreen>同級別的項目</span>需要在該行前面有<span class=bluegreen>相同的空格數量</span>

> 父項目與子項目，建議相差 2 格

---

### 實際操作時間

拿前面提到的麥塊伺服器當範例
我們來實際寫一下 docker-compose.yml

---

### 特殊情況：只要啟動其中一個

若今天只需要啟動 yml 中的其中一個容器，可以透過在啟動指令的最後方加上服務名稱，即可單獨啟動

> docker-compose up -d minecraft

---

#### 額外補充

前一頁所提到「加上服務名稱」的方法，基本適用於大部分 docker-compose 指令。也就是說，如果今天有單一容器需要更新或是重建，可以單獨重新 up 該容器，就可以處理好。

---

## Image 分享

---

### Dockercraft

在 Minecraft 中管理你的容器的方法
![](https://i.imgur.com/ayXlDid.png)

> github.com/docker/dockercraft

---

### 感謝你的聆聽

![](https://i.imgur.com/PwULMqk.png)

快去吃午餐吧!!
